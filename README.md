## Задание

Есть функция, которая рассчитывает возможность выдачи кредита и возможную сумму, если он предварительно одобрен. 
Также функция рассчитывает процент ставки по кредиту.

На вход передаются такие данные:
* Возраст [not negative int], лет
* Пол [F, M]
* Источник дохода [пассивный доход, наёмный работник, собственный бизнес, безработный]
* Доход за последний год [int], млн
* Кредитный рейтинг [-2, -1, 0, 1, 2]
* Запрошенная сумма [0.1 .. 10], млн
* Срок погашения [1..20], лет
* Цель [ипотека, развитие бизнеса, автокредит, потребительский]

**Требования**

Условия выдачи кредита:
* Если возраст превышает пенсионный возраст на момент возврата кредита --> кредит не выдаётся
* Если результат деления запрошенной суммы на срок погашения в годах более трети годового дохода --> кредит не выдаётся
* Если кредитный рейтинг -2 --> кредит не выдаётся
* Если в источнике дохода указано "безработный" --> кредит не выдаётся
* Если годовой платёж (включая проценты) больше половины дохода --> кредит не выдаётся

Суммы кредита:
* Если работают несколько условий по сумме кредита - выбирается наименьшая
* При пассивном доходе выдаётся кредит на сумму до 1 млн, наёмным работникам - до 5 млн, собственное дело - до 10 млн
* При кредитном рейтинге -1 выдаётся кредит на сумму до 1 млн, при 0 - до 5 млн, при 1 или 2 - до 10 млн

Условия изменения базовой ставки:
* Все модификаторы процентной ставки суммируются, применяется итоговый модификатор
* -2% для ипотеки, -0.5% для развития бизнеса, +1.5% для потребительского кредита
* +1.5% для кредитного рейтинга -1, 0% для кредитного рейтинга 0, -0.25% для кредитного рейтинга 1, -0.75% для кредитного рейтинга 2
* Модификатор в зависимости от запрошенной суммы рассчитывается по формуле [-log(sum)]; 
например, для 0.1 млн изменение ставки составит +1%, для 1 млн - 0%, для 10 млн изменение ставки составит -1%
* Для пассивного дохода ставка повышается на 0.5%, для наемных работников ставка снижается на 0.25%, 
для заемщиков с собственным бизнесом ставка повышается на 0.25%

Способ расчета годового платежа:
* Базовая ставка - 10%
* Годовой платеж по кредиту определяется по следующей формуле: (<сумма кредита> * (1 + <срок погашения> * (<базовая ставка> + <модификаторы>))) / <срок погашения>

Информация на выходе:
* Кредит выдаётся/не выдаётся
* Годовой платеж по кредиту

*Задача 1 (обязательная, первый уровень сложности)*

Создай оптимальную тестовую модель для тестирования приложения на базе описанных требований.

## Решение

Существует всего одна функция для расчета суммы кредита. Необходимо ее протестировавать. 
В данном документе предлагается описание тестовой стратегии и тест-кейсы для тестирования данной функции. 

### Почему нельзя использовать исчерпывающее тестировние

Даже если бы функция от 8 параметров имела для каждого аргумента всего по 4 дискретных значения, 
то итоговое количество тестов для полного перебора всех возможных комбинаций составило бы 4^8 == 65536. 
И это все без учета проверок, где будут отсутствовать параметры, будут лишние параметры, 
невалидные значения и др. Поэтому здесь мы попытаемся использовать несколько техник тест-дизайна, 
чтобы упростить работу по тестированию данного функционала. 

### Причина->следствие

Определим сколько всего у нас есть результатов выполнения функции расчета суммы:

- Кредит выдается и сумма годового платежа
- Кредит не выдается
- Ошибка

По итогу мы получаем 3 различных результата, достичь которых можно разными путями. 
Согласно этому принципу все тесты разделим на три группы: успешная выдача, отказ в кредите, ошибочные. 
Для каждой группы будем использовать технии эквивалентного разделения и 
граничных значений для создания тестовых случаев внутри группы. 
Также внутри тест-кейсов будем использовать что-то похожее на *попарное* комбинирование относительно возможных параметров. 
Сама по себе матрица принятия решений будет довольно большой и здесь мне не удастся ее привести целиком. 
Но все "причины" будут описаны в следующих разделах. 

### Успешная выдача

Выделим набор возможных **валидных** параметров. 
Здесь мы сразу же используем и граничные значения (без учета недавлидных) + комбинирование для уменьшения числа кейсов:

*таблица 1*

| age | gender | type     | annual | amount | rating | period | goal     | expected |
| --- | ------ | -------- | ------ | ------ | ------ | ------ | -------- | -------- |
| 1   | f      | passive  | 1      | 0.1    | -1     | 5      | mortgage | 0.031    |
| 18  | m      | employee | 30     | 10     | 0      | 20     | business | 0.677551 |
| 57  | f      | business | 22     | 9      | 1      | 2      | car      | 5.44912  |
| 63  | m      | employee | 1      | 0.2    | 2      | 1      | consumer | 0.222398 |

Здесь нужно несколько пояснений. 
- Возраст 1 взят исключительно из условий. Но очевидно, он не подходит по здравому смыслу. 
В возрасте 1 год еще нельзя иметь источник дохода и документы для оформления кредита. Но формула расчета кредита *позволяет* использовать такой возраст
- Рейтинг -2 и источних дохода "безработный" не указаны, так как они не приводят к успеху
- Отрицательный или нулевой доход не указаны, так как они приводят к тому что условие `доход/3 < сумма/срок` для всех возможных других параметров
- Доход может быть любым - в том числе `MaxInteger`. Однако, явно он слабо влияет итоговую формулу, если `доход >= 3 * Max(сумма) / Min(срок)`. 
Максимальная сумма кредита - 10, срок - 1. При такой сумме автоматически выполняется и другое условие `2 * платеж < доход`. 
Максимальный платеж может быть равен следующему `max(сумма) * (1 + min(срок) * max(ставка))/min(срок)`. 
Это выходит `10 * (1 + 1 * (0.1 + 0.015 + 0.015 + 0.01 + 0.005))/1 == 11.45`. 
Т.е. это 14.5% в год на максимальную сумму при худших условиях. Поэтому в годовом доходе так же указана сумма 22, 
что позволит проверить граничные значения для годового платежа больше половины дохода и меньше половины дохода
- Некоторые параметры подобраны в паре с другими связанными - например возраст 57 + женский пол + срок кредита 2 - должно удоволетворять условию, 
при котором возраст + срок меньше пенсионного

### Параметризованный тест-кейс

Данный тест кейс необходимо пройти для каждой строки таблицы 1

@url = https://wolfr.am/108gtVYLi

| step                                  | expected                             | result |
| ------------------------------------- | ------------------------------------ | ------ |
| Открыть браузер                       | Браузер есть накомпьютере и работает | Успех  |
| Перейти по адресу @url                | Открылась форма с 8 полями           | Успех  |
| Заполнить поля данными текущей строки | Данные корректно введены             | Успех  |
| Нажать кнопку Submit                  | Текст "Одобрено." + сумма  @expected | Успех  |

### Отказано в кредите

Часто одни негативный сценарий куда полезнее десятков позитивных. Здесь поступим сходным образом. 
Составим таблицы с данными, которые выходным результатом возвращают отказ в кредите. 
Но здесь мы будем менять значение одного параметра, при остальных неизменных и валидных. 
Где-то придется также использовать комбинацию - возраст + срок > пенсионного и две комбинации с размером дохода и платежа. 

*таблица 2*

| denied by  | age    | gender | type           | annual | amount | rating | period | goal     |
| ---------- | ------ | ------ | -------------- | ------ | ------ | ------ | ------ | -------- |
| age+gender | **59** | **f**  | passive        | 1      | 0.1    | -1     | 5      | mortgage |
| age+gender | **60** | **m**  | employee       | 30     | 10     | 0      | 20     | business |
| age        | **70** | f      | business       | 22     | 9      | 1      | 2      | car      |
| type       | 63     | m      | **unemployed** | 1      | 0.2    | 2      | 1      | consumer |
| rating     | 1      | f      | passive        | 1      | 0.1    | **-2** | 5      | mortgage |
| annual     | 18     | m      | employee       | **-1** | 10     | 0      | 20     | business |
| annual+sum | 57     | f      | business       | **22** | **10** | 1      | 2      | car      |

### Параметризованный тест-кейс

Данный тест кейс необходимо пройти для каждой строки таблицы 2

@url = https://wolfr.am/108gtVYLi

| step                                  | expected                             | result |
| ------------------------------------- | ------------------------------------ | ------ |
| Открыть браузер                       | Браузер есть накомпьютере и работает | Успех  |
| Перейти по адресу @url                | Открылась форма с 8 полями           | Успех  |
| Заполнить поля данными текущей строки | Данные корректно введены             | Успех  |
| Нажать кнопку Submit                  | ОТКЛОНЕНО                            | Успех  |

### Ошибка

Все тоже самое, что и для отказа в кредите. Однако стоит добавить еще заполнение не всех полей и введение лишние параметры. 
Тут есть сложный момент. Форма, созданная для тестирования кредитного калькулятора стандартным способом 
не позволяет ввести некорректные значения (согласно условиям). 
Однако, есть и другой способ протистировать тот же функционал при помощи Postman (или др утилиты). 
По адресу https://wolfr.am/108gxFaSW располагается API сервис с тем же функционалом. 
Он принимает POST запросы, где в теле должны быть указаны параметры в виде JSON. Пример ниже:

```json
{
	"age":23,
	"gender":"F",
	"type":"employee",
	"annual":2,
	"rating":1,
	"amount":0.1,
	"period":5,
	"goal":"car"
}
```

результат

```json
{
	"success": true,
	"yearPayment": 3.200000000000001e-2
}
```

Таблица с тестовыми даными будет выглядеть так:

*таблица 3*

| denied by        | age    | gender | type        | annual       | amount | rating | period | goal     |
| ---------------- | ------ | ------ | ----------- | ------------ | ------ | ------ | ------ | -------- |
| age              | **-1** | f      | passive     | 1            | 0.1    | -1     | 5      | mortgage |
| gender           | 20     | **x**  | employee    | 30           | 10     | 0      | 20     | business |
| type             | 70     | f      | **testing** | 22           | 9      | 1      | 2      | car      |
| annual           | 63     | m      | unemployed  | **infinity** | 0.2    | 2      | 1      | consumer |
| amount           | 1      | f      | passive     | 1            | **11** | -2     | 5      | mortgage |
| rating           | 18     | m      | employee    | -1           | 10     | **-3** | 20     | business |
| goal             | 57     | f      | business    | 22           | 10     | 1      | 2      | startup  |
| age              |        | m      | employee    | -1           | 10     | -1     | 20     | business |
| annual -> income | 57     | f      | business    | **replaced** | 10     | 1      | 2      | business |


Здесь далеко не все тестовые данные, которые приводят к ошибке, однако, в данном случае нужно определить число ошибочных данных. 
Разумно взять по одному ошибочному значению для каждого параметра. 
А также одну строку без одного из параметров и одну строку с другим именем параметра.

### Параметризованный тест-кейс

Данный тест кейс необходимо пройти для каждой строки таблицы 3

@url = https://wolfr.am/108gtVYLi

| request                           | expected response                 | result |
| --------------------------------- | --------------------------------- | ------ |
| Запрос к @url с данными таблицы 3 | {"message": "argument exception"} | Успех  |

### Дополнительная проверка ошибочного заполнения

UI для расчета суммы кредита проверяет введенные значения. Составим дополнительные тест кейсы для проверки этого:

@url = https://wolfr.am/108gtVYLi

- Очистить все значения

| step                                      | expected                             | result |
| ----------------------------------------- | ------------------------------------ | ------ |
| Открыть браузер                           | Браузер есть накомпьютере и работает | Успех  |
| Перейти по адресу @url                    | Открылась форма с 8 полями           | Успех  |
| Очистить все поля (доступные для очистки) |                                      | Успех  |
| Нажать кнопку Submit                      | Очищенные поля отобразили подсказку  | Успех  |

- Возраст + срок + сумма 

| step                   | expected                                                                                                                              | result |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------- | ------ |
| Открыть браузер        | Браузер есть накомпьютере и работает                                                                                                  | Успех  |
| Перейти по адресу @url | Открылась форма с 8 полями                                                                                                            | Успех  |
| Ввести возраст -1      |                                                                                                                                       | Успех  |
| Ввести срок 21         |                                                                                                                                       | Успех  |
| Ввести сумму 11        |                                                                                                                                       | Успех  |
| Нажать кнопку Submit   | сообщения `Enter a number between 1 and 13,799,000,000.`<br>`Enter a number between 0.1 and 10.`<br>`Enter a number between 1 and 20` | Успех  |

### Задачи 2 и 3

- Решение задачи 2 в файле CreditCalculator.wl
- Решение задачи 3 в файле Tests.cs
